<!-- Action buttons -->
<div class="row mb-3">
  <div class="col-12">
    <button type="button" class="btn btn-primary me-2" (click)="createCollection()">
      <i class="ri-add-line"></i> {{ 'admin.common.add_collection' | translate }}
    </button>
    <button type="button" class="btn btn-outline-primary me-2" (click)="openBulkEditor()">
      <i class="ri-table-line"></i> {{ 'admin.common.bulk_edit' | translate }}
    </button>
  </div>
</div>

<!-- Filters / Config Block -->
<div class="row mb-3">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-body">
        <div class="row align-items-center g-3">
          <div class="col-12 col-md-4 col-lg-3">
            <div class="position-relative">
              <input 
                type="text" 
                class="form-control ps-3 rounded" 
                [placeholder]="'admin.common.search' | translate"
                [value]="searchText()"
                (input)="searchCollections($event)">
              <i class="ri-search-line position-absolute top-50 start-0 translate-middle-y ms-1 text-muted"></i>
            </div>
          </div>
          <div class="col-12 col-md-4 col-lg-2">
            <select class="form-select rounded" [(ngModel)]="filterEnabled" (change)="applyFilters()">
              <option [ngValue]="undefined">{{ 'admin.common.enabled' | translate }}: {{ 'admin.common.all' | translate }}</option>
              <option [ngValue]="true">{{ 'admin.common.enabled' | translate }}: {{ 'admin.common.yes' | translate }}</option>
              <option [ngValue]="false">{{ 'admin.common.enabled' | translate }}: {{ 'admin.common.no' | translate }}</option>
            </select>
          </div>
          <div class="col-12 col-md-4 col-lg-2">
            <input 
              type="text" 
              class="form-control rounded" 
              [(ngModel)]="filterYear" 
              (input)="applyFilters()"
              [placeholder]="'admin.collection.enter_year' | translate">
          </div>
          <div class="col-12 col-md-4 col-lg-2">
            <input 
              type="text" 
              class="form-control rounded" 
              [(ngModel)]="filterPin" 
              (input)="applyFilters()"
              [placeholder]="'admin.collection.enter_pin' | translate">
          </div>
          <div class="col-12 col-md-8 col-lg-3 d-flex justify-content-end">
            <div role="group" class="btn-group">
              <button 
                type="button" 
                class="btn btn-outline-secondary" 
                (click)="clearFilters()">
                <i class="ri-refresh-line"></i> {{ 'admin.common.clear_filters' | translate }}
              </button>
              <button 
                type="button" 
                class="btn btn-outline-primary" 
                (click)="refreshCollections()">
                <i class="ri-refresh-line"></i> {{ 'admin.common.refresh' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Loading indicator -->
@if(loading()) {
<div class="text-center py-4">
  <div class="spinner-border" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
}

<!-- Error message -->
@if(error()) {
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  {{ error() }}
  <button type="button" class="btn-close" (click)="clearError()"></button>
</div>
}

<!-- Collections table -->
@if(!loading() && filteredCollections().length > 0) {
<div class="card">
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
      <tr>
        <th>{{ 'admin.collection.overview.name' | translate }}</th>
        <th>{{ 'admin.collection.overview.responsible' | translate }}</th>
        <th>{{ 'admin.collection.overview.unit' | translate }}</th>
        <th>{{ 'admin.collection.overview.shooting_range' | translate }}</th>
        <th>{{ 'admin.collection.overview.areal' | translate }}</th>
        <th>{{ 'admin.collection.overview.date' | translate }}</th>
        <th>{{ 'admin.collection.overview.shot_count' | translate }}</th>
        <th>{{ 'admin.collection.overview.created_at' | translate }}</th>
        <th style="width: 100px;">{{ 'admin.common.actions' | translate }}</th>
      </tr>
      </thead>
      <tbody>
        @for(collection of filteredCollections(); track collection.id) {
          <tr class="collection-row">
            <td>
              @if(collection.personData) {
                {{ collection.personData.name }}
              }
            </td>
            <td>
              @if(collection.personData) {
                {{ collection.personData.responsible }}
              }
            </td>
            <td>
              @if(collection.personData) {
                {{ collection.personData.unit }}
              }
            </td>
            <td>
              {{collection.arealCategoryName}}
            </td>
            <td>
              {{collection.arealName}}
            </td>
            <td>
              @if(collection.dateData) {
                {{ collection.dateData.date }}
              }
            </td>
            <td [align]="true? 'right' : 'left'">
              {{collection.weaponSum | number:'1.0-0'}}
            </td>
            <td>
              {{ collection.createdAt | date:'short' }}
            </td>
            <td>
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-sm btn-primary" (click)="editCollection(collection)">
                  <i class="ri-edit-line"></i>
                </button>
                <button type="button" class="btn btn-sm btn-danger" (click)="deleteCollection(collection)">
                  <i class="ri-delete-bin-line"></i>
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
}

<!-- No data message -->
@if(!loading() && filteredCollections().length === 0) {
  <app-empty-state
    [title]="'admin.collection.overview.no_entries' | translate"
    [subtitle]="'admin.collection.overview.no_entries_subtitle' | translate"
    iconClass="ri-database-2-line">
    <button type="button" class="btn btn-primary" (click)="createCollection()">
      <i class="ri-add-line"></i> {{ 'admin.collection.overview.create_first_collection' | translate }}
    </button>
  </app-empty-state>
}
